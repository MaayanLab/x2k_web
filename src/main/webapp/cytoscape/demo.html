<html>
<head>
	<link rel="stylesheet" href="jquery.qtip.min.css">
</head>
<body id="graph">
<script src="jquery.min.js"></script>
<script src="cytoscape.min.js"></script>
<script src="jquery.qtip.min.js"></script>
<script src="cytoscape-qtip.js"></script>
<script src="cola.v3.min.js"></script>
<script src="cytoscape-cola.js"></script>
<script>


//takes an interaction in x2k output format and turns it into a cytoscape
//style interaction - currently, the PMIDs are just placeholders

function convertInteraction(idx, interaction_array, node_array){
	source = node_array[interaction_array[idx]["source"]]["name"];
	target = node_array[interaction_array[idx]["target"]]["name"];
	new_interaction = {data:{id: idx,
							 source: source,
							 target: target,
							 pmid: 123456789}};
	return new_interaction;
}

function convertNode(x2k_node){
	cyto_node = {data: {name: x2k_node["name"],
						id: x2k_node["name"]},
				 classes: x2k_node["type"]}
	return cyto_node;
}

//take an x2k output formatted json and convert it into a cytoscape input json
function cytoscapeJson(x2k_json){
	$.getJSON(x2k_json, function(json) {
    
    network = json.network; //ignore kinase rankings, etc. - just make network
	node_array = network.nodes;
	interaction_array = network.interactions;
	cytoscape_array = [];

	for(i = 0; i < node_array.length; i++){
		cyto_node = convertNode(node_array[i]);
		cytoscape_array.push(cyto_node);
	}

	for(i = 0; i < interaction_array.length; i++){
		cyto_interaction = convertInteraction(i, interaction_array, node_array);
		cytoscape_array.push(cyto_interaction);
	} 
    console.log(cytoscape_array);
    return cytoscape_array;
	});
}

cytoscapeJson("test-json.json");

//danny boy's code
var cy = cytoscape({
	container: $('#graph'),
	style: [
		{
			"selector": "core",
			"style": {
				"selection-box-color": "#AAD8FF",
				"selection-box-border-color": "#8BB0D0",
				"selection-box-opacity": "0.2"
			}
		},
		{
			"selector": "node",
			"style": {
				"content": "data(name)",
				"font-size": "12px",
				"text-valign": "center",
				"text-halign": "center",
				"text-outline-color": "#555",
				"text-outline-width": "2px",
				"color": "#fff",
				"overlay-padding": "6px",
				"z-index": "10"
			}
		},
		{
			"selector": ".tf",
			"style": {
				"background-color": "#555",
				"width": "50",
				"height": "50"
			}
		},
		{
			"selector": ".kinase",
			"style": {
				"background-color": "#aaa",
				"width": "40",
				"height": "40"
			}
		},
		{
			"selector": ".other",
			"style": {
				"background-color": "#500",
				"width": "60",
				"height": "60"
			}
		},
		{
			"selector": ".hidden",
			"style": {
				"display": "none"
			}
		},
		{
			"selector": "edge",
			"style": {
				"curve-style": "haystack",
				"haystack-radius": "0.5",
				"opacity": "0.4",
				"line-color": "#222",
				"width": "mapData(weight, 0, 1, 1, 8)",
				"overlay-padding": "3px"
			}
		}
	],
	elements: [
			{
				data: {
					id: 'CTTN',
					name: 'CTTN'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'FLNA',
					name: 'FLNA'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ACTB',
					name: 'ACTB'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'CAV1',
					name: 'CAV1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'CRK',
					name: 'CRK'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ITGB1BP1',
					name: 'ITGB1BP1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'MSN',
					name: 'MSN'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'KTN1',
					name: 'KTN1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ARHGAP24',
					name: 'ARHGAP24'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'DEF6',
					name: 'DEF6'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'DOCK1',
					name: 'DOCK1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ELMO1',
					name: 'ELMO1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ARHGEF6',
					name: 'ARHGEF6'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ARHGEF7',
					name: 'ARHGEF7'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'STAT3',
					name: 'STAT3'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'PAK1',
					name: 'PAK1'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'PRKCA',
					name: 'PRKCA'
				},
				classes: 'tf'
			},
			{
				data: {
					id: 'ARHGAP32',
					name: 'ARHGAP32'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'BCAR3',
					name: 'BCAR3'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'SOS1',
					name: 'SOS1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'TIAM1',
					name: 'TIAM1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'TRIO',
					name: 'TRIO'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'VAV1',
					name: 'VAV1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'VAV2',
					name: 'VAV2'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'VAV3',
					name: 'VAV3'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'ARHGEF2',
					name: 'ARHGEF2'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'RAC1',
					name: 'RAC1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'PLD1',
					name: 'PLD1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'PIK3CA',
					name: 'PIK3CA'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'PIP5K1C',
					name: 'PIP5K1C'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'AKT1',
					name: 'AKT1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'MAPK8',
					name: 'MAPK8'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 'TESK1',
					name: 'TESK1'
				},
				classes: 'kinase'
			},
			{
				data: {
					id: 0,
					source: 'AKT1',
					target: 'ARHGEF2',
					pmid: '21513698'
				}
			},
			{
				data: {
					id: 1,
					source: 'ITGB1BP1',
					target: 'RAC1',
					pmid: '11807099'
				}
			},
			{
				data: {
					id: 2,
					source: 'PIP5K1C',
					target: 'PLD1',
					pmid: '11032811'
				}
			},
			{
				data: {
					id: 3,
					source: 'ARHGAP24',
					target: 'FLNA',
					pmid: '16862148'
				}
			},
			{
				data: {
					id: 4,
					source: 'CRK',
					target: 'MAPK8',
					pmid: '11432831'
				}
			},
			{
				data: {
					id: 5,
					source: 'RAC1',
					target: 'VAV2',
					pmid: '16397238'
				}
			},
			{
				data: {
					id: 6,
					source: 'MAPK8',
					target: 'STAT3',
					pmid: '10521505'
				}
			},
			{
				data: {
					id: 7,
					source: 'CRK',
					target: 'CTTN',
					pmid: '15263018'
				}
			},
			{
				data: {
					id: 8,
					source: 'DEF6',
					target: 'RAC1',
					pmid: '15023524'
				}
			},
			{
				data: {
					id: 9,
					source: 'AKT1',
					target: 'PRKCA',
					pmid: '11410591'
				}
			},
			{
				data: {
					id: 10,
					source: 'PLD1',
					target: 'PRKCA',
					pmid: '1559964'
				}
			},
			{
				data: {
					id: 11,
					source: 'RAC1',
					target: 'TESK1',
					pmid: '15169836'
				}
			},
			{
				data: {
					id: 12,
					source: 'PRKCA',
					target: 'TIAM1',
					pmid: '10734127'
				}
			},
			{
				data: {
					id: 13,
					source: 'PAK1',
					target: 'RAC1',
					pmid: '9989831'
				}
			},
			{
				data: {
					id: 14,
					source: 'ACTB',
					target: 'PLD1',
					pmid: '11373276'
				}
			},
			{
				data: {
					id: 15,
					source: 'ACTB',
					target: 'ARHGAP24',
					pmid: '15611138'
				}
			},
			{
				data: {
					id: 16,
					source: 'ARHGAP24',
					target: 'RAC1',
					pmid: '15611138'
				}
			},
			{
				data: {
					id: 17,
					source: 'FLNA',
					target: 'RAC1',
					pmid: '11146652'
				}
			},
			{
				data: {
					id: 18,
					source: 'ARHGAP32',
					target: 'CRK',
					pmid: '12454018'
				}
			},
			{
				data: {
					id: 19,
					source: 'PRKCA',
					target: 'STAT3',
					pmid: '10446219'
				}
			},
			{
				data: {
					id: 20,
					source: 'FLNA',
					target: 'PRKCA',
					pmid: '12704190'
				}
			},
			{
				data: {
					id: 21,
					source: 'CTTN',
					target: 'RAC1',
					pmid: '9683637'
				}
			},
			{
				data: {
					id: 22,
					source: 'ARHGEF2',
					target: 'PAK1',
					pmid: '14970201'
				}
			},
			{
				data: {
					id: 23,
					source: 'BCAR3',
					target: 'PAK1',
					pmid: '14583477'
				}
			},
			{
				data: {
					id: 24,
					source: 'RAC1',
					target: 'SOS1',
					pmid: '9438849'
				}
			},
			{
				data: {
					id: 25,
					source: 'ARHGEF6',
					target: 'PAK1',
					pmid: '9659915'
				}
			},
			{
				data: {
					id: 26,
					source: 'BCAR3',
					target: 'PIK3CA',
					pmid: '15671247'
				}
			},
			{
				data: {
					id: 27,
					source: 'ACTB',
					target: 'PRKCA',
					pmid: '15590896'
				}
			},
			{
				data: {
					id: 28,
					source: 'ACTB',
					target: 'CTTN',
					pmid: '7680654'
				}
			},
			{
				data: {
					id: 29,
					source: 'ARHGEF6',
					target: 'ARHGEF7',
					pmid: '15306850 12499396'
				}
			},
			{
				data: {
					id: 30,
					source: 'CRK',
					target: 'RAC1',
					pmid: '12874273'
				}
			},
			{
				data: {
					id: 31,
					source: 'PIK3CA',
					target: 'VAV1',
					pmid: '9891995'
				}
			},
			{
				data: {
					id: 32,
					source: 'ARHGEF2',
					target: 'RAC1',
					pmid: '11595749 9857026'
				}
			},
			{
				data: {
					id: 33,
					source: 'FLNA',
					target: 'PAK1',
					pmid: '12198493'
				}
			},
			{
				data: {
					id: 34,
					source: 'CAV1',
					target: 'SOS1',
					pmid: '15976327'
				}
			},
			{
				data: {
					id: 35,
					source: 'AKT1',
					target: 'ARHGAP32',
					pmid: '12446789'
				}
			},
			{
				data: {
					id: 36,
					source: 'RAC1',
					target: 'VAV1',
					pmid: '9601639'
				}
			},
			{
				data: {
					id: 37,
					source: 'ELMO1',
					target: 'RAC1',
					pmid: '14638695'
				}
			},
			{
				data: {
					id: 38,
					source: 'CRK',
					target: 'DOCK1',
					pmid: '9808620'
				}
			},
			{
				data: {
					id: 39,
					source: 'KTN1',
					target: 'RAC1',
					pmid: '8769096'
				}
			},
			{
				data: {
					id: 40,
					source: 'RAC1',
					target: 'STAT3',
					pmid: '11021801'
				}
			},
			{
				data: {
					id: 41,
					source: 'ACTB',
					target: 'RAC1',
					pmid: '11027608'
				}
			},
			{
				data: {
					id: 42,
					source: 'RAC1',
					target: 'TIAM1',
					pmid: '7753201'
				}
			},
			{
				data: {
					id: 43,
					source: 'BCAR3',
					target: 'RAC1',
					pmid: '14583477'
				}
			},
			{
				data: {
					id: 44,
					source: 'CTTN',
					target: 'PAK1',
					pmid: '16854367'
				}
			},
			{
				data: {
					id: 45,
					source: 'ARHGEF6',
					target: 'RAC1',
					pmid: '16492808'
				}
			},
			{
				data: {
					id: 46,
					source: 'AKT1',
					target: 'RAC1',
					pmid: '10617634'
				}
			},
			{
				data: {
					id: 47,
					source: 'CAV1',
					target: 'PLD1',
					pmid: '10090765 12429840'
				}
			},
			{
				data: {
					id: 48,
					source: 'ARHGAP32',
					target: 'RAC1',
					pmid: '12454018 12531901'
				}
			},
			{
				data: {
					id: 49,
					source: 'PIK3CA',
					target: 'RAC1',
					pmid: '9148763'
				}
			},
			{
				data: {
					id: 50,
					source: 'RAC1',
					target: 'TRIO',
					pmid: '9464532'
				}
			},
			{
				data: {
					id: 51,
					source: 'DOCK1',
					target: 'ELMO1',
					pmid: '12134158'
				}
			},
			{
				data: {
					id: 52,
					source: 'ARHGEF7',
					target: 'RAC1',
					pmid: '14557270 11309380 9659915'
				}
			},
			{
				data: {
					id: 53,
					source: 'PLD1',
					target: 'RAC1',
					pmid: '11950936'
				}
			},
			{
				data: {
					id: 54,
					source: 'FLNA',
					target: 'TRIO',
					pmid: '11146652'
				}
			},
			{
				data: {
					id: 55,
					source: 'PIP5K1C',
					target: 'RAC1',
					pmid: '12874273'
				}
			},
			{
				data: {
					id: 56,
					source: 'CRK',
					target: 'VAV1',
					pmid: '8621483'
				}
			},
			{
				data: {
					id: 57,
					source: 'ACTB',
					target: 'FLNA',
					pmid: '325564'
				}
			},
			{
				data: {
					id: 58,
					source: 'CAV1',
					target: 'FLNA',
					pmid: '10637311'
				}
			},
			{
				data: {
					id: 59,
					source: 'AKT1',
					target: 'ARHGEF6',
					pmid: '15306850'
				}
			},
			{
				data: {
					id: 60,
					source: 'AKT1',
					target: 'KTN1',
					pmid: '11162552'
				}
			},
			{
				data: {
					id: 61,
					source: 'MAPK8',
					target: 'RAC1',
					pmid: '18423204'
				}
			},
			{
				data: {
					id: 62,
					source: 'DOCK1',
					target: 'RAC1',
					pmid: '12134158'
				}
			},
			{
				data: {
					id: 63,
					source: 'AKT1',
					target: 'FLNA',
					pmid: '15461588'
				}
			},
			{
				data: {
					id: 64,
					source: 'ACTB',
					target: 'PAK1',
					pmid: '9298982'
				}
			},
			{
				data: {
					id: 65,
					source: 'AKT1',
					target: 'ARHGEF7',
					pmid: '15306850'
				}
			},
			{
				data: {
					id: 66,
					source: 'MSN',
					target: 'RAC1',
					pmid: '12467587'
				}
			},
			{
				data: {
					id: 67,
					source: 'AKT1',
					target: 'PAK1',
					pmid: '14585966'
				}
			},
			{
				data: {
					id: 68,
					source: 'RAC1',
					target: 'VAV3',
					pmid: '10523675'
				}
			},
			{
				data: {
					id: 69,
					source: 'CRK',
					target: 'SOS1',
					pmid: '8810325'
				}
			},
			{
				data: {
					id: 70,
					source: 'CAV1',
					target: 'RAC1',
					pmid: '20460433 15976327'
				}
			},
			{
				data: {
					id: 71,
					source: 'CRK',
					target: 'ELMO1',
					pmid: '15700267'
				}
			},
			{
				data: {
					id: 72,
					source: 'PRKCA',
					target: 'RAC1',
					pmid: '11284700'
				}
			},
	],
	layout: {
		name: 'cola',
		maxSimulationTime: 1000
	}
});

cy.nodes().forEach(function(node) {
	var name = node.data('name');
	node.qtip({
		content: [
			{
				name: 'View node graph',
				url: '/components/'+name+'.html'
			},
			{
				name: 'View on Harminizome',
				url: 'http://amp.pharm.mssm.edu/Harmonizome/gene/'+name
			},
			{
				name: 'View on GeneCard',
				url: 'http://www.genecards.org/cgi-bin/carddisp.pl?gene='+name
			}
		].map(function(link) {
				return '<a href="'+link.url+'">'+link.name+'</a>';
			}).join('<br />\n'),
		position: {
			my: 'top center',
			at: 'bottom center'
		},
		style: {
			classes: 'qtip',
			tip: {
				width: 16,
				height: 8
			}
		}
	});
});

cy.edges().forEach(function(edge) {
	edge.qtip({
		content: edge.data('pmid').split(' ').map(function(pmid) {
				return {
						name: 'View PubMed Article ('+pmid+')',
						url: 'http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=pubmed&dopt=Abstract&list_uids='+pmid
					}
			}).map(function(link) {
				return '<a href="'+link.url+'">'+link.name+'</a>';
			}).join('<br />\n'),
		position: {
			my: 'top center',
			at: 'bottom center'
		},
		style: {
			classes: 'qtip',
			tip: {
				width: 16,
				height: 8
			}
		}
	});
});

// Weird Daniel code that doesn't do much

// $('#tf').change(function() {
// 	if(!$(this).is(':checked'))
// 		cy.$('.tf').addClass('hidden');
// 	else
// 		cy.$('.tf').removeClass('hidden');
// });

// $('#kinase').change(function() {
// 	if(!$(this).is(':checked'))
// 		cy.$('.kinase').addClass('hidden');
// 	else
// 		cy.$('.kinase').removeClass('hidden');
// });cy.$('#RAC1').addClass('other')
</script>
</body>
</html>